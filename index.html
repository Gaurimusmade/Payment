<html >
<head>

  <title>Razorpay Payment Integration</title>
</head>
<body>
  <h1>Razorpay Payment Integration</h1>

  <div id="payment-form">
    <label for="amount">Amount:</label>
    <input type="number" id="amount" name="amount" required>
    <button id="create-order-btn">Create Order</button>
  </div>

  <div id="payment-response"></div>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>
    
    const createOrderBtn = document.getElementById('create-order-btn');
    const paymentResponseDiv = document.getElementById('payment-response');

    createOrderBtn.addEventListener('click', async () => {
      const amount = document.getElementById('amount').value;

      try {
        const response = await fetch('http://localhost:5000/api/checkout/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ amount })
        });

        const data = await response.json();
        if (response.ok) {
          paymentResponseDiv.textContent = JSON.stringify(data, null, 2);
          if (data.order.id) {
            const options = {
              key: 'rzp_test_VNcmgF1nK97bYT',
              amount: data.order.amount,
              currency: 'INR',
              order_id: data.order.id,
              handler: async function(response) {
                const verifyResponse = await fetch('http://localhost:5000/api/paymentVerification/', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    razorpay_payment_id: response.razorpay_payment_id,
                    razorpay_order_id: response.razorpay_order_id,
                    razorpay_signature:response.razorpay_signature
                  })
                });

                const verifyData = await verifyResponse.json();

                if (verifyResponse.ok) {
                  alert('Payment successful!');
                } else {
                  alert('Payment failed!');
                }
              }
            };

            const rzp = new Razorpay(options);
            rzp.open();
          }
        } else {
          paymentResponseDiv.textContent = data.error;
        }
      } catch (error) {
        console.error('Error creating order:', error);
        paymentResponseDiv.textContent = 'Failed to create order';
      }
    });
  </script>
</body>
</html>
